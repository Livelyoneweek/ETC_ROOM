plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.5'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'kr.co.choi'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = '17'
}

configurations {
    compileOnly { extendsFrom annotationProcessor }
}

repositories {
    mavenCentral()
}


dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    runtimeOnly 'com.h2database:h2'

    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    testImplementation 'org.springframework.boot:spring-boot-starter-test'

    // QR, ZXing 라이브러리 implementation 'com.google.zxing:core:3.5.3'
    implementation 'com.google.zxing:javase:3.5.3'

    // 상태점검
    implementation 'org.springframework.boot:spring-boot-starter-actuator'

    // QueryDSL 7
    implementation 'io.github.openfeign.querydsl:querydsl-jpa:7.0'
    annotationProcessor 'io.github.openfeign.querydsl:querydsl-apt:7.0:jakarta'
    testAnnotationProcessor 'io.github.openfeign.querydsl:querydsl-apt:7.0:jakarta'
    //

    implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.0' // jpa 쿼리파라미터 바인딩

    // build 시에 정해놓은 rule 로 아키텍쳐 검증
    // https://mvnrepository.com/artifact/com.tngtech.archunit/archunit-junit5
    testImplementation 'com.tngtech.archunit:archunit-junit5:1.4.1'

    testImplementation('org.springframework.boot:spring-boot-starter-test')

    //테스트 lombok 사용
    testCompileOnly 'org.projectlombok:lombok'
    testAnnotationProcessor 'org.projectlombok:lombok'
}

def querydslDir = "src/main/generated"

tasks.withType(JavaCompile) {
    options.getGeneratedSourceOutputDirectory().set(file(querydslDir))
}

sourceSets {
    main {
        java.srcDirs += querydslDir
    }
}

clean {
    delete file(querydslDir)
}


tasks.named('test') {
    useJUnitPlatform()
}
